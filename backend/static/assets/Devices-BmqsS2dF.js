import{_ as Z,r as v,a as S,A as ee,c as U,o as u,b as M,C as le,d as a,w as t,f as s,G as ae,B as te,j as V,g as d,l as A,F as ne,I as T,J as j,H as oe,x as E,K as ie,k as de,L as se,z as ue,E as w}from"./index-CjpewyOQ.js";import{a as z}from"./index-DPVtAufC.js";const re={class:"devices-container"},pe={class:"page-header"},me={class:"filter-bar"},fe={key:1},ve={class:"pagination-wrapper"},ce={__name:"Devices",setup(ye){const N=v([]),$=v([]),F=v(!1),C=v(!1),k=v(null),x=v(null),y=v(!1),I=v(!1),i=S({imei:"",type:"indoor",name:""}),n=S({type:"",online:"",stationId:null,search:""}),r=S({page:1,perPage:10,total:0});async function m(){F.value=!0;try{const o={page:r.page,per_page:r.perPage};n.type&&(o.type=n.type),n.online&&(o.online=n.online),n.stationId&&(o.station_id=n.stationId),n.search&&(o.search=n.search);const g=(await z.get("/api/devices",{params:o})).data.data;N.value=g.items||[],r.total=g.total||0}catch{}finally{F.value=!1}}async function L(){try{const o=await z.get("/api/stations",{params:{per_page:1e3}});$.value=o.data.data.items||[]}catch{}}function _(){r.page=1,m()}function G(){n.type="",n.online="",n.stationId=null,n.search="",r.page=1,m()}function H(o){k.value=o,x.value=null,C.value=!0}async function J(){if(!x.value){w.warning("请选择加油站");return}y.value=!0;try{await z.post(`/api/devices/${k.value.imei}/bind`,{station_id:x.value}),w.success("绑定成功"),C.value=!1,m()}catch{}finally{y.value=!1}}async function O(o){try{await ue.confirm(`确定要解绑设备 "${o.imei}" 吗？`,"解绑确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await z.post(`/api/devices/${o.imei}/unbind`),w.success("解绑成功"),m()}catch{}}function Q(){i.imei="",i.type="indoor",i.name="",I.value=!0}async function R(){if(!i.imei){w.warning("请输入设备IMEI");return}if(!i.type){w.warning("请选择设备类型");return}y.value=!0;try{await z.post("/api/devices",{imei:i.imei,type:i.type,name:i.name||void 0}),w.success("添加成功"),I.value=!1,m()}catch{}finally{y.value=!1}}return ee(()=>{m(),L()}),(o,l)=>{const g=s("el-icon"),p=s("el-button"),f=s("el-option"),h=s("el-select"),B=s("el-input"),c=s("el-table-column"),P=s("el-tag"),W=s("el-table"),X=s("el-pagination"),b=s("el-form-item"),q=s("el-form"),K=s("el-dialog"),Y=te("loading");return u(),U("div",re,[M("div",pe,[l[15]||(l[15]=M("h2",null,"设备管理",-1)),a(p,{type:"primary",onClick:Q},{default:t(()=>[a(g,null,{default:t(()=>[a(A(ne))]),_:1}),l[14]||(l[14]=d(" 添加设备 ",-1))]),_:1})]),M("div",me,[a(h,{modelValue:n.type,"onUpdate:modelValue":l[0]||(l[0]=e=>n.type=e),placeholder:"设备类型",clearable:"",style:{width:"120px"},onChange:_},{default:t(()=>[a(f,{label:"室内机",value:"indoor"}),a(f,{label:"室外机",value:"outdoor"})]),_:1},8,["modelValue"]),a(h,{modelValue:n.online,"onUpdate:modelValue":l[1]||(l[1]=e=>n.online=e),placeholder:"在线状态",clearable:"",style:{width:"120px"},onChange:_},{default:t(()=>[a(f,{label:"在线",value:"1"}),a(f,{label:"离线",value:"0"})]),_:1},8,["modelValue"]),a(h,{modelValue:n.stationId,"onUpdate:modelValue":l[2]||(l[2]=e=>n.stationId=e),placeholder:"选择加油站",clearable:"",filterable:"",style:{width:"200px"},onChange:_},{default:t(()=>[(u(!0),U(T,null,j($.value,e=>(u(),V(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(B,{modelValue:n.search,"onUpdate:modelValue":l[3]||(l[3]=e=>n.search=e),placeholder:"搜索IMEI或加油站名称",clearable:"",style:{width:"220px"},onKeyup:ae(_,["enter"]),onClear:_},{prefix:t(()=>[a(g,null,{default:t(()=>[a(A(oe))]),_:1})]),_:1},8,["modelValue"]),a(p,{type:"primary",onClick:_},{default:t(()=>[...l[16]||(l[16]=[d("搜索",-1)])]),_:1}),a(p,{onClick:G},{default:t(()=>[...l[17]||(l[17]=[d("重置",-1)])]),_:1})]),le((u(),V(W,{data:N.value,stripe:""},{default:t(()=>[a(c,{prop:"imei",label:"IMEI",width:"160"}),a(c,{prop:"type",label:"类型",width:"100"},{default:t(({row:e})=>[a(P,{type:e.type==="indoor"?"success":"warning"},{default:t(()=>[d(E(e.type==="indoor"?"室内机":"室外机"),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"station_name",label:"绑定加油站","min-width":"150"},{default:t(({row:e})=>[d(E(e.station_name||"未绑定"),1)]),_:1}),a(c,{prop:"online",label:"在线状态",width:"100"},{default:t(({row:e})=>[a(P,{type:e.online?"success":"danger"},{default:t(()=>[d(E(e.online?"在线":"离线"),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"last_seen",label:"最后在线",width:"170"}),a(c,{prop:"vbat",label:"电池电压",width:"120"},{default:t(({row:e})=>[e.type==="outdoor"&&e.vbat!==null?(u(),U("span",{key:0,class:ie({"low-battery":e.low_battery})},[d(E(e.vbat)+"V ",1),e.low_battery?(u(),V(g,{key:0,color:"#E6A23C"},{default:t(()=>[a(A(se))]),_:1})):de("",!0)],2)):(u(),U("span",fe,"-"))]),_:1}),a(c,{label:"操作",width:"150",fixed:"right"},{default:t(({row:e})=>[e.station_id?(u(),V(p,{key:1,type:"danger",text:"",size:"small",onClick:D=>O(e)},{default:t(()=>[...l[19]||(l[19]=[d(" 解绑 ",-1)])]),_:1},8,["onClick"])):(u(),V(p,{key:0,type:"primary",text:"",size:"small",onClick:D=>H(e)},{default:t(()=>[...l[18]||(l[18]=[d(" 绑定 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[Y,F.value]]),M("div",ve,[a(X,{"current-page":r.page,"onUpdate:currentPage":l[4]||(l[4]=e=>r.page=e),"page-size":r.perPage,"onUpdate:pageSize":l[5]||(l[5]=e=>r.perPage=e),"page-sizes":[10,20,50,100],total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:m,onCurrentChange:m},null,8,["current-page","page-size","total"])]),a(K,{modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=e=>C.value=e),title:"绑定设备到加油站",width:"450px"},{footer:t(()=>[a(p,{onClick:l[7]||(l[7]=e=>C.value=!1)},{default:t(()=>[...l[20]||(l[20]=[d("取消",-1)])]),_:1}),a(p,{type:"primary",loading:y.value,onClick:J},{default:t(()=>[...l[21]||(l[21]=[d(" 确定绑定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(q,{"label-width":"100px"},{default:t(()=>[a(b,{label:"设备IMEI"},{default:t(()=>{var e;return[a(B,{value:(e=k.value)==null?void 0:e.imei,disabled:""},null,8,["value"])]}),_:1}),a(b,{label:"设备类型"},{default:t(()=>{var e;return[a(P,{type:((e=k.value)==null?void 0:e.type)==="indoor"?"success":"warning"},{default:t(()=>{var D;return[d(E(((D=k.value)==null?void 0:D.type)==="indoor"?"室内机":"室外机"),1)]}),_:1},8,["type"])]}),_:1}),a(b,{label:"选择加油站",required:""},{default:t(()=>[a(h,{modelValue:x.value,"onUpdate:modelValue":l[6]||(l[6]=e=>x.value=e),placeholder:"请选择加油站",filterable:"",style:{width:"100%"}},{default:t(()=>[(u(!0),U(T,null,j($.value,e=>(u(),V(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(K,{modelValue:I.value,"onUpdate:modelValue":l[13]||(l[13]=e=>I.value=e),title:"添加设备",width:"450px"},{footer:t(()=>[a(p,{onClick:l[12]||(l[12]=e=>I.value=!1)},{default:t(()=>[...l[22]||(l[22]=[d("取消",-1)])]),_:1}),a(p,{type:"primary",loading:y.value,onClick:R},{default:t(()=>[...l[23]||(l[23]=[d(" 确定添加 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(q,{model:i,"label-width":"100px"},{default:t(()=>[a(b,{label:"IMEI",required:""},{default:t(()=>[a(B,{modelValue:i.imei,"onUpdate:modelValue":l[9]||(l[9]=e=>i.imei=e),placeholder:"请输入设备IMEI"},null,8,["modelValue"])]),_:1}),a(b,{label:"设备类型",required:""},{default:t(()=>[a(h,{modelValue:i.type,"onUpdate:modelValue":l[10]||(l[10]=e=>i.type=e),placeholder:"请选择设备类型",style:{width:"100%"}},{default:t(()=>[a(f,{label:"室内机",value:"indoor"}),a(f,{label:"室外机",value:"outdoor"})]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"设备名称"},{default:t(()=>[a(B,{modelValue:i.name,"onUpdate:modelValue":l[11]||(l[11]=e=>i.name=e),placeholder:"可选，设备备注名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},be=Z(ce,[["__scopeId","data-v-bad8d7b7"]]);export{be as default};
