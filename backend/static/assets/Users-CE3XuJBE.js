import{_ as K,i as U,r as u,a as L,A as O,c as P,o as h,b as B,C as Q,d as l,w as s,f as n,B as W,j as X,g as r,l as Y,F as Z,x as E,z as ee,E as y}from"./index-CjpewyOQ.js";import{a as f}from"./index-DPVtAufC.js";import{useUserStore as le}from"./user-B_yB4m5z.js";const te={class:"users-container"},ae={class:"page-header"},se={__name:"Users",setup(oe){const $=le(),D=U(()=>{var o;return(o=$.user)==null?void 0:o.id}),V=u([]),_=u(!1),d=u(!1),i=u(!1),v=u(!1),g=u(null),b=u(null),t=L({username:"",password:"",role:"user",status:1}),I=U(()=>({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:50,message:"用户名长度为 2-50 个字符",trigger:"blur"}],password:i.value?[]:[{required:!0,message:"请输入密码",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]}));async function w(){_.value=!0;try{const o=await f.get("/api/users");V.value=o.data.data||[]}catch{}finally{_.value=!1}}function S(){i.value=!1,b.value=null,d.value=!0}function q(o){i.value=!0,b.value=o.id,t.username=o.username,t.password="",t.role=o.role,t.status=o.status,d.value=!0}async function z(o){try{await ee.confirm(`确定要删除用户 "${o.username}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await f.delete(`/api/users/${o.id}`),y.success("删除成功"),w()}catch{}}async function F(){if(await g.value.validate().catch(()=>!1)){v.value=!0;try{const e={username:t.username,role:t.role,status:t.status};t.password&&(e.password=t.password),i.value?(await f.put(`/api/users/${b.value}`,e),y.success("更新成功")):(await f.post("/api/users",e),y.success("创建成功")),d.value=!1,w()}catch{}finally{v.value=!1}}}function M(){var o;t.username="",t.password="",t.role="user",t.status=1,(o=g.value)==null||o.resetFields()}return O(()=>{w()}),(o,e)=>{const N=n("el-icon"),m=n("el-button"),p=n("el-table-column"),x=n("el-tag"),T=n("el-table"),k=n("el-input"),c=n("el-form-item"),C=n("el-option"),A=n("el-select"),R=n("el-switch"),j=n("el-form"),G=n("el-dialog"),H=W("loading");return h(),P("div",te,[B("div",ae,[e[7]||(e[7]=B("h2",null,"用户管理",-1)),l(m,{type:"primary",onClick:S},{default:s(()=>[l(N,null,{default:s(()=>[l(Y(Z))]),_:1}),e[6]||(e[6]=r(" 新增用户 ",-1))]),_:1})]),Q((h(),X(T,{data:V.value,stripe:""},{default:s(()=>[l(p,{prop:"id",label:"ID",width:"80"}),l(p,{prop:"username",label:"用户名"}),l(p,{prop:"role",label:"角色",width:"120"},{default:s(({row:a})=>[l(x,{type:a.role==="admin"?"danger":"info"},{default:s(()=>[r(E(a.role==="admin"?"超级管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"status",label:"状态",width:"100"},{default:s(({row:a})=>[l(x,{type:a.status===1?"success":"danger"},{default:s(()=>[r(E(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"created_at",label:"创建时间",width:"180"}),l(p,{label:"操作",width:"180",fixed:"right"},{default:s(({row:a})=>[l(m,{type:"primary",text:"",size:"small",onClick:J=>q(a)},{default:s(()=>[...e[8]||(e[8]=[r(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(m,{type:"danger",text:"",size:"small",onClick:J=>z(a),disabled:a.id===D.value},{default:s(()=>[...e[9]||(e[9]=[r(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[H,_.value]]),l(G,{modelValue:d.value,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value=a),title:i.value?"编辑用户":"新增用户",width:"500px",onClose:M},{footer:s(()=>[l(m,{onClick:e[4]||(e[4]=a=>d.value=!1)},{default:s(()=>[...e[10]||(e[10]=[r("取消",-1)])]),_:1}),l(m,{type:"primary",loading:v.value,onClick:F},{default:s(()=>[...e[11]||(e[11]=[r(" 确定 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[l(j,{ref_key:"formRef",ref:g,model:t,rules:I.value,"label-width":"80px"},{default:s(()=>[l(c,{label:"用户名",prop:"username"},{default:s(()=>[l(k,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=a=>t.username=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(c,{label:"密码",prop:"password"},{default:s(()=>[l(k,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=a=>t.password=a),type:"password",placeholder:i.value?"留空则不修改密码":"请输入密码","show-password":""},null,8,["modelValue","placeholder"])]),_:1}),l(c,{label:"角色",prop:"role"},{default:s(()=>[l(A,{modelValue:t.role,"onUpdate:modelValue":e[2]||(e[2]=a=>t.role=a),placeholder:"请选择角色",style:{width:"100%"}},{default:s(()=>[l(C,{label:"超级管理员",value:"admin"}),l(C,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"状态",prop:"status"},{default:s(()=>[l(R,{modelValue:t.status,"onUpdate:modelValue":e[3]||(e[3]=a=>t.status=a),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}},de=K(se,[["__scopeId","data-v-6563d266"]]);export{de as default};
