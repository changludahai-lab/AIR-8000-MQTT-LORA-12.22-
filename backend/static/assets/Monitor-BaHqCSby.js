import{_ as j,r as x,a as G,i as M,z as H,M as J,c as v,o as r,b as s,C as O,k as b,d as t,f as u,w as a,G as P,A as Q,j as L,I as q,J as W,g as f,t as d,l as c,N as X,p as Y,O as Z,P as $,L as R,H as tt,Q as et,R as st,S as lt,K as E}from"./index-BCm-iu0U.js";import{a as at}from"./index-D-6YZA5Z.js";const ot={class:"monitor-container"},nt={class:"page-header"},it={class:"header-actions"},dt={class:"stats-row"},ct={class:"stat-content"},rt={class:"stat-icon total"},ut={class:"stat-info"},_t={class:"stat-value"},ft={class:"stat-content"},vt={class:"stat-icon online"},pt={class:"stat-info"},ht={class:"stat-value"},mt={class:"stat-content"},yt={class:"stat-icon offline"},gt={class:"stat-info"},bt={class:"stat-value"},wt={class:"stat-content"},Vt={class:"stat-icon warning"},kt={class:"stat-info"},Ct={class:"stat-value"},xt={class:"filter-bar"},Bt={class:"device-grid"},Dt={class:"device-header"},It={class:"device-type"},Lt={class:"device-status"},Nt={class:"device-body"},Ut={class:"device-imei"},zt={class:"device-station"},At={class:"device-time"},Mt={key:0,class:"device-battery"},Rt={key:0,class:"update-info"},Et={key:0,class:"auto-refresh-hint"},Kt={__name:"Monitor",setup(St){const p=x([]),h=x(!1),w=x(!0),B=x("");let V=null;const n=G({type:"",status:"",search:""}),k=M(()=>{const o=p.value.length,e=p.value.filter(m=>m.online).length,_=o-e,i=p.value.filter(m=>m.low_battery).length;return{total:o,online:e,offline:_,lowBattery:i}}),N=M(()=>{let o=[...p.value];if(n.type&&(o=o.filter(e=>e.type===n.type)),n.status==="online"?o=o.filter(e=>e.online):n.status==="offline"?o=o.filter(e=>!e.online):n.status==="lowBattery"&&(o=o.filter(e=>e.low_battery)),n.search){const e=n.search.toLowerCase();o=o.filter(_=>_.imei.toLowerCase().includes(e)||_.station_name&&_.station_name.toLowerCase().includes(e))}return o});async function D(){h.value=!0;try{const o=await at.get("/api/devices",{params:{per_page:1e3}});p.value=o.data.data.items||[],B.value=new Date().toLocaleString("zh-CN")}catch{}finally{h.value=!1}}function C(){}function K(o){o?U():I()}function U(){I(),V=setInterval(()=>{D()},3e4)}function I(){V&&(clearInterval(V),V=null)}return H(()=>{D(),w.value&&U()}),J(()=>{I()}),(o,e)=>{const _=u("el-switch"),i=u("el-icon"),m=u("el-button"),y=u("el-card"),g=u("el-option"),z=u("el-select"),S=u("el-input"),A=u("el-tag"),T=u("el-empty"),F=Q("loading");return r(),v("div",ot,[s("div",nt,[e[5]||(e[5]=s("h2",null,"设备监控",-1)),s("div",it,[t(_,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),"active-text":"自动刷新","inactive-text":"",onChange:K},null,8,["modelValue"]),t(m,{type:"primary",loading:h.value,onClick:D},{default:a(()=>[t(i,null,{default:a(()=>[t(c(X))]),_:1}),e[4]||(e[4]=f(" 刷新 ",-1))]),_:1},8,["loading"])])]),s("div",dt,[t(y,{class:"stat-card"},{default:a(()=>[s("div",ct,[s("div",rt,[t(i,null,{default:a(()=>[t(c(Y))]),_:1})]),s("div",ut,[s("div",_t,d(k.value.total),1),e[6]||(e[6]=s("div",{class:"stat-label"},"设备总数",-1))])])]),_:1}),t(y,{class:"stat-card"},{default:a(()=>[s("div",ft,[s("div",vt,[t(i,null,{default:a(()=>[t(c(Z))]),_:1})]),s("div",pt,[s("div",ht,d(k.value.online),1),e[7]||(e[7]=s("div",{class:"stat-label"},"在线设备",-1))])])]),_:1}),t(y,{class:"stat-card"},{default:a(()=>[s("div",mt,[s("div",yt,[t(i,null,{default:a(()=>[t(c($))]),_:1})]),s("div",gt,[s("div",bt,d(k.value.offline),1),e[8]||(e[8]=s("div",{class:"stat-label"},"离线设备",-1))])])]),_:1}),t(y,{class:"stat-card"},{default:a(()=>[s("div",wt,[s("div",Vt,[t(i,null,{default:a(()=>[t(c(R))]),_:1})]),s("div",kt,[s("div",Ct,d(k.value.lowBattery),1),e[9]||(e[9]=s("div",{class:"stat-label"},"低电量",-1))])])]),_:1})]),s("div",xt,[t(z,{modelValue:n.type,"onUpdate:modelValue":e[1]||(e[1]=l=>n.type=l),placeholder:"设备类型",clearable:"",style:{width:"120px"},onChange:C},{default:a(()=>[t(g,{label:"室内机",value:"indoor"}),t(g,{label:"室外机",value:"outdoor"})]),_:1},8,["modelValue"]),t(z,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=l=>n.status=l),placeholder:"状态筛选",clearable:"",style:{width:"120px"},onChange:C},{default:a(()=>[t(g,{label:"在线",value:"online"}),t(g,{label:"离线",value:"offline"}),t(g,{label:"低电量",value:"lowBattery"})]),_:1},8,["modelValue"]),t(S,{modelValue:n.search,"onUpdate:modelValue":e[3]||(e[3]=l=>n.search=l),placeholder:"搜索IMEI或加油站",clearable:"",style:{width:"200px"},onKeyup:P(C,["enter"]),onClear:C},{prefix:a(()=>[t(i,null,{default:a(()=>[t(c(tt))]),_:1})]),_:1},8,["modelValue"])]),O((r(),v("div",Bt,[(r(!0),v(q,null,W(N.value,l=>(r(),L(y,{key:l.imei,class:E(["device-card",{offline:!l.online,"low-battery":l.low_battery}])},{default:a(()=>[s("div",Dt,[s("div",It,[t(A,{type:l.type==="indoor"?"success":"warning",size:"small"},{default:a(()=>[f(d(l.type==="indoor"?"室内机":"室外机"),1)]),_:2},1032,["type"])]),s("div",Lt,[t(A,{type:l.online?"success":"danger",size:"small",effect:"dark"},{default:a(()=>[f(d(l.online?"在线":"离线"),1)]),_:2},1032,["type"])])]),s("div",Nt,[s("div",Ut,d(l.imei),1),s("div",zt,[t(i,null,{default:a(()=>[t(c(et))]),_:1}),f(" "+d(l.station_name||"未绑定"),1)]),s("div",At,[t(i,null,{default:a(()=>[t(c(st))]),_:1}),f(" "+d(l.last_seen||"从未上线"),1)]),l.type==="outdoor"&&l.vbat!==null?(r(),v("div",Mt,[t(i,null,{default:a(()=>[t(c(lt))]),_:1}),s("span",{class:E({"battery-warning":l.low_battery})},[f(d(l.vbat)+"mV ",1),l.low_battery?(r(),L(i,{key:0,color:"#E6A23C"},{default:a(()=>[t(c(R))]),_:1})):b("",!0)],2)])):b("",!0)])]),_:2},1032,["class"]))),128)),N.value.length===0&&!h.value?(r(),L(T,{key:0,description:"暂无设备数据"})):b("",!0)])),[[F,h.value]]),B.value?(r(),v("div",Rt,[f(" 最后更新: "+d(B.value)+" ",1),w.value?(r(),v("span",Et,"（每30秒自动刷新）")):b("",!0)])):b("",!0)])}}},jt=j(Kt,[["__scopeId","data-v-2bb7ce5b"]]);export{jt as default};
