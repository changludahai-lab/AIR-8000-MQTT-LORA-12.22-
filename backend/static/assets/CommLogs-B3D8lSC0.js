import{_ as D,r as b,a as x,A as E,c as h,o as _,b as m,C as L,d as t,w as l,f as r,G as F,B as J,j as w,I as O,J as j,g as d,x as c}from"./index-CjpewyOQ.js";import{a as z}from"./index-DPVtAufC.js";const K={class:"comm-logs-container"},A={class:"filter-bar"},G={key:1},Q={class:"payload-text"},q={class:"payload-detail"},H={class:"pagination-wrapper"},R={__name:"CommLogs",setup(W){const I=b([]),V=b([]),f=b(!1),a=x({direction:"",sourceType:"",sourceImei:"",stationId:null}),i=x({page:1,perPage:20,total:0});async function g(){f.value=!0;try{const n={page:i.page,per_page:i.perPage};a.direction&&(n.direction=a.direction),a.sourceType&&(n.source_type=a.sourceType),a.sourceImei&&(n.source_imei=a.sourceImei),a.stationId&&(n.station_id=a.stationId);const p=(await z.get("/api/comm-logs",{params:n})).data.data;I.value=p.items||[],i.total=p.total||0}catch{}finally{f.value=!1}}async function T(){try{const n=await z.get("/api/stations",{params:{per_page:1e3}});V.value=n.data.data.items||[]}catch{}}function k(n){try{return JSON.stringify(JSON.parse(n),null,2)}catch{return n}}function u(){i.page=1,g()}function P(){a.direction="",a.sourceType="",a.sourceImei="",a.stationId=null,i.page=1,g()}return E(()=>{g(),T()}),(n,o)=>{const p=r("el-option"),y=r("el-select"),S=r("el-input"),C=r("el-button"),s=r("el-table-column"),v=r("el-tag"),U=r("el-popover"),B=r("el-table"),M=r("el-pagination"),N=J("loading");return _(),h("div",K,[o[8]||(o[8]=m("div",{class:"page-header"},[m("h2",null,"通讯记录")],-1)),m("div",A,[t(y,{modelValue:a.direction,"onUpdate:modelValue":o[0]||(o[0]=e=>a.direction=e),placeholder:"通讯方向",clearable:"",style:{width:"120px"},onChange:u},{default:l(()=>[t(p,{label:"接收",value:"receive"}),t(p,{label:"转发",value:"forward"})]),_:1},8,["modelValue"]),t(y,{modelValue:a.sourceType,"onUpdate:modelValue":o[1]||(o[1]=e=>a.sourceType=e),placeholder:"来源类型",clearable:"",style:{width:"120px"},onChange:u},{default:l(()=>[t(p,{label:"室内机",value:"indoor"}),t(p,{label:"室外机",value:"outdoor"})]),_:1},8,["modelValue"]),t(S,{modelValue:a.sourceImei,"onUpdate:modelValue":o[2]||(o[2]=e=>a.sourceImei=e),placeholder:"来源IMEI",clearable:"",style:{width:"180px"},onKeyup:F(u,["enter"]),onClear:u},null,8,["modelValue"]),t(y,{modelValue:a.stationId,"onUpdate:modelValue":o[3]||(o[3]=e=>a.stationId=e),placeholder:"选择加油站",clearable:"",filterable:"",style:{width:"200px"},onChange:u},{default:l(()=>[(_(!0),h(O,null,j(V.value,e=>(_(),w(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(C,{type:"primary",onClick:u},{default:l(()=>[...o[6]||(o[6]=[d("搜索",-1)])]),_:1}),t(C,{onClick:P},{default:l(()=>[...o[7]||(o[7]=[d("重置",-1)])]),_:1})]),L((_(),w(B,{data:I.value,stripe:""},{default:l(()=>[t(s,{prop:"id",label:"ID",width:"80"}),t(s,{prop:"direction",label:"方向",width:"80"},{default:l(({row:e})=>[t(v,{type:e.direction==="receive"?"success":"warning",size:"small"},{default:l(()=>[d(c(e.direction==="receive"?"接收":"转发"),1)]),_:2},1032,["type"])]),_:1}),t(s,{prop:"source_type",label:"来源类型",width:"100"},{default:l(({row:e})=>[t(v,{type:e.source_type==="indoor"?"primary":"info",size:"small"},{default:l(()=>[d(c(e.source_type==="indoor"?"室内机":"室外机"),1)]),_:2},1032,["type"])]),_:1}),t(s,{prop:"source_imei",label:"来源IMEI",width:"160"}),t(s,{prop:"target_type",label:"目标类型",width:"100"},{default:l(({row:e})=>[e.target_type?(_(),w(v,{key:0,type:e.target_type==="indoor"?"primary":"info",size:"small"},{default:l(()=>[d(c(e.target_type==="indoor"?"室内机":"室外机"),1)]),_:2},1032,["type"])):(_(),h("span",G,"-"))]),_:1}),t(s,{prop:"target_imei",label:"目标IMEI",width:"160"},{default:l(({row:e})=>[d(c(e.target_imei||"-"),1)]),_:1}),t(s,{prop:"station_name",label:"加油站",width:"150"},{default:l(({row:e})=>[d(c(e.station_name||"未绑定"),1)]),_:1}),t(s,{prop:"topic",label:"MQTT主题","min-width":"200","show-overflow-tooltip":""}),t(s,{prop:"payload",label:"原始数据","min-width":"200"},{default:l(({row:e})=>[t(U,{placement:"top-start",width:400,trigger:"hover"},{reference:l(()=>[m("span",Q,c(e.payload),1)]),default:l(()=>[m("pre",q,c(k(e.payload)),1)]),_:2},1024)]),_:1}),t(s,{prop:"created_at",label:"时间",width:"170"})]),_:1},8,["data"])),[[N,f.value]]),m("div",H,[t(M,{"current-page":i.page,"onUpdate:currentPage":o[4]||(o[4]=e=>i.page=e),"page-size":i.perPage,"onUpdate:pageSize":o[5]||(o[5]=e=>i.perPage=e),"page-sizes":[20,50,100,200],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])])])}}},Z=D(R,[["__scopeId","data-v-827710f6"]]);export{Z as default};
