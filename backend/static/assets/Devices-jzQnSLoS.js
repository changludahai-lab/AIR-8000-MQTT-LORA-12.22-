import{_ as R,r as m,a as S,z as W,c as V,o as s,b as k,C as X,d as t,w as a,f as i,G as Y,A as Z,j as v,I as N,J as F,l as K,H as ee,g as d,t as w,K as le,k as te,L as ae,y as ne,E}from"./index-BCm-iu0U.js";import{a as x}from"./index-D-6YZA5Z.js";const oe={class:"devices-container"},ie={class:"filter-bar"},se={key:1},de={class:"pagination-wrapper"},ue={__name:"Devices",setup(re){const M=m([]),I=m([]),z=m(!1),g=m(!1),y=m(null),b=m(null),B=m(!1),n=S({type:"",online:"",stationId:null,search:""}),u=S({page:1,perPage:10,total:0});async function p(){z.value=!0;try{const o={page:u.page,per_page:u.perPage};n.type&&(o.type=n.type),n.online&&(o.online=n.online),n.stationId&&(o.station_id=n.stationId),n.search&&(o.search=n.search);const r=(await x.get("/api/devices",{params:o})).data.data;M.value=r.items||[],u.total=r.total||0}catch{}finally{z.value=!1}}async function T(){try{const o=await x.get("/api/stations",{params:{per_page:1e3}});I.value=o.data.data.items||[]}catch{}}function f(){u.page=1,p()}function j(){n.type="",n.online="",n.stationId=null,n.search="",u.page=1,p()}function A(o){y.value=o,b.value=null,g.value=!0}async function L(){if(!b.value){E.warning("请选择加油站");return}B.value=!0;try{await x.post(`/api/devices/${y.value.imei}/bind`,{station_id:b.value}),E.success("绑定成功"),g.value=!1,p()}catch{}finally{B.value=!1}}async function q(o){try{await ne.confirm(`确定要解绑设备 "${o.imei}" 吗？`,"解绑确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await x.post(`/api/devices/${o.imei}/unbind`),E.success("解绑成功"),p()}catch{}}return W(()=>{p(),T()}),(o,l)=>{const r=i("el-option"),C=i("el-select"),$=i("el-icon"),P=i("el-input"),_=i("el-button"),c=i("el-table-column"),U=i("el-tag"),G=i("el-table"),H=i("el-pagination"),D=i("el-form-item"),J=i("el-form"),O=i("el-dialog"),Q=Z("loading");return s(),V("div",oe,[l[15]||(l[15]=k("div",{class:"page-header"},[k("h2",null,"设备管理")],-1)),k("div",ie,[t(C,{modelValue:n.type,"onUpdate:modelValue":l[0]||(l[0]=e=>n.type=e),placeholder:"设备类型",clearable:"",style:{width:"120px"},onChange:f},{default:a(()=>[t(r,{label:"室内机",value:"indoor"}),t(r,{label:"室外机",value:"outdoor"})]),_:1},8,["modelValue"]),t(C,{modelValue:n.online,"onUpdate:modelValue":l[1]||(l[1]=e=>n.online=e),placeholder:"在线状态",clearable:"",style:{width:"120px"},onChange:f},{default:a(()=>[t(r,{label:"在线",value:"1"}),t(r,{label:"离线",value:"0"})]),_:1},8,["modelValue"]),t(C,{modelValue:n.stationId,"onUpdate:modelValue":l[2]||(l[2]=e=>n.stationId=e),placeholder:"选择加油站",clearable:"",filterable:"",style:{width:"200px"},onChange:f},{default:a(()=>[(s(!0),V(N,null,F(I.value,e=>(s(),v(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(P,{modelValue:n.search,"onUpdate:modelValue":l[3]||(l[3]=e=>n.search=e),placeholder:"搜索IMEI或加油站名称",clearable:"",style:{width:"220px"},onKeyup:Y(f,["enter"]),onClear:f},{prefix:a(()=>[t($,null,{default:a(()=>[t(K(ee))]),_:1})]),_:1},8,["modelValue"]),t(_,{type:"primary",onClick:f},{default:a(()=>[...l[9]||(l[9]=[d("搜索",-1)])]),_:1}),t(_,{onClick:j},{default:a(()=>[...l[10]||(l[10]=[d("重置",-1)])]),_:1})]),X((s(),v(G,{data:M.value,stripe:""},{default:a(()=>[t(c,{prop:"imei",label:"IMEI",width:"160"}),t(c,{prop:"type",label:"类型",width:"100"},{default:a(({row:e})=>[t(U,{type:e.type==="indoor"?"success":"warning"},{default:a(()=>[d(w(e.type==="indoor"?"室内机":"室外机"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"station_name",label:"绑定加油站","min-width":"150"},{default:a(({row:e})=>[d(w(e.station_name||"未绑定"),1)]),_:1}),t(c,{prop:"online",label:"在线状态",width:"100"},{default:a(({row:e})=>[t(U,{type:e.online?"success":"danger"},{default:a(()=>[d(w(e.online?"在线":"离线"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"last_seen",label:"最后在线",width:"170"}),t(c,{prop:"vbat",label:"电池电压",width:"120"},{default:a(({row:e})=>[e.type==="outdoor"&&e.vbat!==null?(s(),V("span",{key:0,class:le({"low-battery":e.low_battery})},[d(w(e.vbat)+"mV ",1),e.low_battery?(s(),v($,{key:0,color:"#E6A23C"},{default:a(()=>[t(K(ae))]),_:1})):te("",!0)],2)):(s(),V("span",se,"-"))]),_:1}),t(c,{label:"操作",width:"150",fixed:"right"},{default:a(({row:e})=>[e.station_id?(s(),v(_,{key:1,type:"danger",text:"",size:"small",onClick:h=>q(e)},{default:a(()=>[...l[12]||(l[12]=[d(" 解绑 ",-1)])]),_:1},8,["onClick"])):(s(),v(_,{key:0,type:"primary",text:"",size:"small",onClick:h=>A(e)},{default:a(()=>[...l[11]||(l[11]=[d(" 绑定 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[Q,z.value]]),k("div",de,[t(H,{"current-page":u.page,"onUpdate:currentPage":l[4]||(l[4]=e=>u.page=e),"page-size":u.perPage,"onUpdate:pageSize":l[5]||(l[5]=e=>u.perPage=e),"page-sizes":[10,20,50,100],total:u.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])]),t(O,{modelValue:g.value,"onUpdate:modelValue":l[8]||(l[8]=e=>g.value=e),title:"绑定设备到加油站",width:"450px"},{footer:a(()=>[t(_,{onClick:l[7]||(l[7]=e=>g.value=!1)},{default:a(()=>[...l[13]||(l[13]=[d("取消",-1)])]),_:1}),t(_,{type:"primary",loading:B.value,onClick:L},{default:a(()=>[...l[14]||(l[14]=[d(" 确定绑定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(J,{"label-width":"100px"},{default:a(()=>[t(D,{label:"设备IMEI"},{default:a(()=>{var e;return[t(P,{value:(e=y.value)==null?void 0:e.imei,disabled:""},null,8,["value"])]}),_:1}),t(D,{label:"设备类型"},{default:a(()=>{var e;return[t(U,{type:((e=y.value)==null?void 0:e.type)==="indoor"?"success":"warning"},{default:a(()=>{var h;return[d(w(((h=y.value)==null?void 0:h.type)==="indoor"?"室内机":"室外机"),1)]}),_:1},8,["type"])]}),_:1}),t(D,{label:"选择加油站",required:""},{default:a(()=>[t(C,{modelValue:b.value,"onUpdate:modelValue":l[6]||(l[6]=e=>b.value=e),placeholder:"请选择加油站",filterable:"",style:{width:"100%"}},{default:a(()=>[(s(!0),V(N,null,F(I.value,e=>(s(),v(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},me=R(ue,[["__scopeId","data-v-c1e101c8"]]);export{me as default};
