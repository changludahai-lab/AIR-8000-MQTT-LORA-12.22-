import{_ as E,r as v,a as k,z as F,c as _,o as i,b as g,C as N,d as l,w as n,f as r,G as j,A as K,j as b,I as z,J as R,l as G,H,g as c,t as f}from"./index-N6dGGa3X.js";import{a as T}from"./index-CvrQXHFG.js";const J={class:"alarms-container"},L={class:"filter-bar"},q={key:1,class:"no-data"},O={class:"pagination-wrapper"},Q={__name:"Alarms",setup(W){const w=v([]),V=v([]),y=v(!1),a=k({stationId:null,alarmType:"",dateRange:null,search:""}),s=k({page:1,perPage:10,total:0});async function m(){y.value=!0;try{const o={page:s.page,per_page:s.perPage};a.stationId&&(o.station_id=a.stationId),a.alarmType&&(o.alarm_type=a.alarmType),a.dateRange&&a.dateRange.length===2&&(o.start_date=a.dateRange[0],o.end_date=a.dateRange[1]),a.search&&(o.search=a.search);const d=(await T.get("/api/alarms",{params:o})).data.data;w.value=d.items||[],s.total=d.total||0}catch{}finally{y.value=!1}}async function U(){try{const o=await T.get("/api/stations",{params:{per_page:1e3}});V.value=o.data.data.items||[]}catch{}}function p(){s.page=1,m()}function D(){a.stationId=null,a.alarmType="",a.dateRange=null,a.search="",s.page=1,m()}return F(()=>{U(),m()}),(o,t)=>{const d=r("el-option"),x=r("el-select"),M=r("el-date-picker"),P=r("el-icon"),A=r("el-input"),C=r("el-button"),u=r("el-table-column"),h=r("el-tag"),B=r("el-table"),S=r("el-pagination"),Y=K("loading");return i(),_("div",J,[t[8]||(t[8]=g("div",{class:"page-header"},[g("h2",null,"报警日志")],-1)),g("div",L,[l(x,{modelValue:a.stationId,"onUpdate:modelValue":t[0]||(t[0]=e=>a.stationId=e),placeholder:"选择加油站",clearable:"",style:{width:"200px"},onChange:p},{default:n(()=>[(i(!0),_(z,null,R(V.value,e=>(i(),b(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(x,{modelValue:a.alarmType,"onUpdate:modelValue":t[1]||(t[1]=e=>a.alarmType=e),placeholder:"报警类型",clearable:"",style:{width:"120px"},onChange:p},{default:n(()=>[l(d,{label:"报警",value:"alarm"}),l(d,{label:"取消",value:"cancel"})]),_:1},8,["modelValue"]),l(M,{modelValue:a.dateRange,"onUpdate:modelValue":t[2]||(t[2]=e=>a.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"260px"},onChange:p},null,8,["modelValue"]),l(A,{modelValue:a.search,"onUpdate:modelValue":t[3]||(t[3]=e=>a.search=e),placeholder:"搜索加油站名称或IMEI",clearable:"",style:{width:"220px"},onKeyup:j(p,["enter"]),onClear:p},{prefix:n(()=>[l(P,null,{default:n(()=>[l(G(H))]),_:1})]),_:1},8,["modelValue"]),l(C,{type:"primary",onClick:p},{default:n(()=>[...t[6]||(t[6]=[c("搜索",-1)])]),_:1}),l(C,{onClick:D},{default:n(()=>[...t[7]||(t[7]=[c("重置",-1)])]),_:1})]),N((i(),b(B,{data:w.value,stripe:""},{default:n(()=>[l(u,{prop:"created_at",label:"时间",width:"180"}),l(u,{prop:"station_name",label:"加油站","min-width":"150"},{default:n(({row:e})=>[c(f(e.station_name||"-"),1)]),_:1}),l(u,{prop:"indoor_imei",label:"室内机IMEI",width:"160"}),l(u,{prop:"alarm_type",label:"类型",width:"100"},{default:n(({row:e})=>[l(h,{type:e.alarm_type==="alarm"?"danger":"success"},{default:n(()=>[c(f(e.alarm_type==="alarm"?"报警":"取消"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"outdoor_imeis",label:"转发室外机","min-width":"200"},{default:n(({row:e})=>[e.outdoor_imeis&&e.outdoor_imeis.length>0?(i(!0),_(z,{key:0},R(e.outdoor_imeis,I=>(i(),b(h,{key:I,type:"info",size:"small",style:{"margin-right":"4px","margin-bottom":"2px"}},{default:n(()=>[c(f(I),1)]),_:2},1024))),128)):(i(),_("span",q,"-"))]),_:1}),l(u,{prop:"forward_status",label:"转发状态",width:"100"},{default:n(({row:e})=>[l(h,{type:e.forward_status===1?"success":"warning"},{default:n(()=>[c(f(e.forward_status===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[Y,y.value]]),g("div",O,[l(S,{"current-page":s.page,"onUpdate:currentPage":t[4]||(t[4]=e=>s.page=e),"page-size":s.perPage,"onUpdate:pageSize":t[5]||(t[5]=e=>s.perPage=e),"page-sizes":[10,20,50,100],total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:m,onCurrentChange:m},null,8,["current-page","page-size","total"])])])}}},$=E(Q,[["__scopeId","data-v-a0177da4"]]);export{$ as default};
